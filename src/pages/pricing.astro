---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Layer from "../components/Layer.astro";
import If from "../components/jinja/If.astro";
import "../styles/base.css";
import icon from "../lib/icon.svg?url";

const plans = [
  {
    name: "Hobby",
    planId: "hobby",
    price: "$5/month",
    description: "250 daily requests for all models",
  },
  {
    name: "Pro",
    planId: "pro",
    price: "$10/month",
    description: "1000 daily requests for all models, plus priority support",
  },
];
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href={icon} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pricing</title>
  </head>
  <body>
    <Header />
    <main>
      <h2 class="font-headline-large">With plans, never worry about prices per token</h2>
      <div class="plans">
        {
          plans.map(({ name, planId, price, description }) => (
            <>
              <If condition={`plan == '${planId}'`}>
                <a
                  class="plan"
                  href="/plan-api/free"
                  onclick={`if(!confirm('Remove all ${name} priviliges?')){event.preventDefault()}`}
                >
                  <Layer />
                  <h3>
                    {name} • <span class="price">{price}</span>
                  </h3>
                  <p>{description}</p>
                  <div class="fake-button error">Unsubscribe</div>
                </a>
              </If>
              <If condition={`plan != '${planId}'`}>
                <If condition="not loggedin">
                  <a class="plan" href="/signin">
                    <Layer />
                    <h3>
                      {name} • <span class="price">{price}</span>
                    </h3>
                    <p>{description}</p>
                    <div class="fake-button">Sign in</div>
                  </a>
                </If>
                <If condition="loggedin">
                  <a
                    class="plan"
                    href={`/plan-api/${planId}`}
                    onclick={`if(!confirm('Subscribe to ${name}?')){event.preventDefault()}`}
                  >
                    <Layer />
                    <h3>
                      {name} • <span class="price">{price}</span>
                    </h3>
                    <p>{description}</p>
                    <div class="fake-button">Purchase</div>
                  </a>
                </If>
              </If>
            </>
          ))
        }
      </div>
      <h2 class="font-headline-large">Models</h2>
    </main>

    <Footer pushToBottom={true} />
  </body>
</html>

<style>
  main {
    display: flex;
    flex-direction: column;

    align-self: center;
    width: 100%;
    max-width: 50rem;

    > * {
      margin-top: 1em;
    }
  }
  .plans {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
  }
  .plan {
    display: flex;
    flex-direction: column;
    text-align: start;
    position: relative;

    padding: 0.5rem;
    border-radius: 1.5rem;
    background-color: rgb(var(--m3-scheme-surface-container));
    cursor: pointer;

    > h3 {
      font-weight: bold;
    }
    .price {
      color: rgb(var(--m3-scheme-primary));
    }
    > p {
      margin-bottom: 0.5rem;
    }
    > .fake-button {
      display: flex;
      align-items: center;
      align-self: end;
      height: 3rem;
      border-radius: 1.5rem;

      padding-inline: 1rem;

      background-color: rgb(var(--m3-scheme-primary));
      color: rgb(var(--m3-scheme-on-primary));
      &.error {
        background-color: rgb(var(--m3-scheme-error));
        color: rgb(var(--m3-scheme-on-error));
      }

      margin-top: auto;
      margin-right: -0.5rem;
      margin-bottom: -0.5rem;
    }
  }
</style>
