---
interface Props {
  items: string;
  component: any;
  props: Record<string, string>;
}
const { items, component: Component, props: propMapping } = Astro.props;

// Hardcoded dev context - only used in development
const devContext: Record<string, any[]> = {
  models: [
    {
      id: "kimi-k2-thinking",
      quantization: "fp4",
      context_length: "262,144",
      max_completion_tokens: "262,144",
      pricing: {
        prompt: "0.00",
        completion: "0.00",
      },
      speed: 77,
    },
    {
      id: "kimi-k2-thinking-turbo",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "1.00",
        completion: "2.25",
      },
      speed: 15,
    },
    {
      id: "kimi-k2-0905",
      quantization: "fp8",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.15",
        completion: "0.55",
      },
      speed: 33,
    },
    {
      id: "kimi-k2-0905-turbo",
      quantization: "fp8",
      context_length: "131,072",
      max_completion_tokens: "8,192",
      pricing: {
        prompt: "0.35",
        completion: "1.00",
      },
      speed: 685,
    },
    {
      id: "glm-4.6-turbo",
      quantization: "fp8",
      context_length: "202,752",
      max_completion_tokens: "202,752",
      pricing: {
        prompt: "0.50",
        completion: "2.25",
      },
      speed: 25,
    },
    {
      id: "minimax-m2",
      quantization: "fp8",
      context_length: "196,608",
      max_completion_tokens: "196,608",
      pricing: {
        prompt: "0.00",
        completion: "0.00",
      },
      speed: 140,
    },
    {
      id: "deepseek-v3.1:free",
      quantization: "fp8",
      context_length: "128,000",
      max_completion_tokens: "128,000",
      pricing: {
        prompt: "0.00",
        completion: "0.00",
      },
      speed: 79,
    },
    {
      id: "qwen3-coder:free",
      quantization: "fp8",
      context_length: "256,000",
      max_completion_tokens: "256,000",
      pricing: {
        prompt: "0.00",
        completion: "0.00",
      },
      speed: 73,
    },
    {
      id: "kimi-k2-eco",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.05",
        completion: "0.10",
      },
      speed: 16,
    },
    {
      id: "glm-4.6",
      quantization: "fp8",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.30",
        completion: "0.60",
      },
      speed: 129,
    },
    {
      id: "glm-4.5",
      quantization: "fp8",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.20",
        completion: "0.40",
      },
      speed: 165,
    },
    {
      id: "ring-1t",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.40",
        completion: "1.00",
      },
      speed: 112,
    },
    {
      id: "deepseek-v3.2-exp",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.15",
        completion: "0.30",
      },
      speed: 164,
    },
    {
      id: "deepseek-v3.1-terminus",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.20",
        completion: "0.50",
      },
      speed: 26,
    },
    {
      id: "deepseek-v3.1-terminus-reasoner",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.20",
        completion: "0.50",
      },
      speed: 45,
    },
    {
      id: "deepseek-v3.1",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.15",
        completion: "0.50",
      },
      speed: 8,
    },
    {
      id: "deepseek-v3.1-reasoner",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.15",
        completion: "0.50",
      },
      speed: 88,
    },
    {
      id: "deepseek-v3-0324",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "8,192",
      pricing: {
        prompt: "0.20",
        completion: "0.25",
      },
      speed: 33,
    },
    {
      id: "deepseek-v3-0324-turbo",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "8,192",
      pricing: {
        prompt: "0.50",
        completion: "1.00",
      },
      speed: 22,
    },
    {
      id: "deepseek-r1-0528",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.25",
        completion: "0.25",
      },
      speed: 33,
    },
    {
      id: "deepseek-r1-0528-turbo",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "1.00",
        completion: "2.00",
      },
      speed: 125,
    },
    {
      id: "qwen3-next-80b-a3b-instruct",
      quantization: "fp8",
      context_length: "262,144",
      max_completion_tokens: "262,144",
      pricing: {
        prompt: "0.08",
        completion: "0.38",
      },
      speed: 24,
    },
    {
      id: "qwen3-235b-a22b-2507-instruct",
      quantization: "fp8",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.10",
        completion: "0.25",
      },
      speed: 96,
    },
    {
      id: "qwen3-235b-a22b-2507-thinking",
      quantization: "fp8",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.10",
        completion: "0.30",
      },
      speed: 40,
    },
    {
      id: "qwen3-coder",
      quantization: "fp8",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.15",
        completion: "0.35",
      },
      speed: 71,
    },
    {
      id: "qwen3-coder-turbo",
      quantization: "fp8",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.20",
        completion: "0.50",
      },
      speed: 254,
    },
    {
      id: "gpt-oss-120b",
      quantization: "fp4",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.07",
        completion: "0.27",
      },
      speed: 148,
    },
    {
      id: "gpt-oss-safeguard-120b",
      quantization: "fp8",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.07",
        completion: "0.27",
      },
      speed: 135,
    },
    {
      id: "gemma-3-27b-it",
      quantization: "fp8",
      context_length: "131,072",
      max_completion_tokens: "131,072",
      pricing: {
        prompt: "0.04",
        completion: "0.10",
      },
      speed: 81,
    },
    {
      id: "llama-4-scout",
      quantization: "fp8",
      context_length: "262,144",
      max_completion_tokens: "16,384",
      pricing: {
        prompt: "0.08",
        completion: "0.40",
      },
      speed: 65,
    },
    {
      id: "llama3.3-70b",
      quantization: "fp8",
      context_length: "131,072",
      max_completion_tokens: "8,192",
      pricing: {
        prompt: "0.12",
        completion: "0.20",
      },
      speed: 31,
    },
    {
      id: "deepseek-r1-distill-llama-70b",
      quantization: "fp4",
      context_length: "65,536",
      max_completion_tokens: "65,536",
      pricing: {
        prompt: "0.10",
        completion: "0.10",
      },
      speed: 64,
    },
    {
      id: "deepseek-r1-distill-qwen-32b",
      quantization: "fp4",
      context_length: "65,536",
      max_completion_tokens: "65,536",
      pricing: {
        prompt: "0.10",
        completion: "0.10",
      },
      speed: 65,
    },
    {
      id: "stok-0.4.1",
      quantization: "stok",
      context_length: "2,048",
      max_completion_tokens: "2,048",
      pricing: {
        prompt: "0.00",
        completion: "0.00",
      },
      speed: 4720,
    },
  ],
};

const prodProps: Record<string, string> = {};
Object.entries(propMapping).forEach(([propName, path]) => {
  prodProps[propName] = "item" + path;
});

const buildItemDev = (item: any) => {
  const props: Record<string, any> = {};
  Object.entries(propMapping).forEach(([propName, path]) => {
    // Remove leading dot
    let cleanPath = path.replace(/^\./, "");

    // Handle bracket notation like pricing["prompt"]
    const bracketMatch = cleanPath.match(/^([^[]+)\["([^"]+)"\]$/);
    if (bracketMatch) {
      props[propName] = item?.[bracketMatch[1]]?.[bracketMatch[2]];
    } else {
      // Handle dot notation
      const keys = cleanPath.split(".").filter(k => k);
      props[propName] = keys.reduce((current, key) => current?.[key], item);
    }
  });
  return props;
};
---

{
  import.meta.env.DEV ? (
    (devContext[items] || []).map((item) => {
      return <Component {...buildItemDev(item)} />;
    })
  ) : (
    <>
      <Fragment set:html={`{% for item in ${items} %}`} />
      <Component {...prodProps} />
      <Fragment set:html="{% endfor %}" />
    </>
  )
}
